<!DOCTYPE html>
<html>

<head>
    <title>Class Notes Management System</title>
    <style>
        /* CSS styles for the page (same as the previous example) */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        h1 {
            text-align: center;
            margin-top: 20px;
            color: #2c3e50;
        }

        #authForm {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 30px;
        }

        #loginForm {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        #loginForm label {
            font-weight: bold;
        }

        #loginForm input {
            width: 200px;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
        }

        #loginForm button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }

        #loginForm button:hover {
            background-color: #2980b9;
        }

        #container {
            display: flex;
            margin: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        #channels {
            width: 20%;
            padding: 15px;
            background-color: #ecf0f1;
            border-right: 1px solid #bdc3c7;
        }

        #channels h3 {
            margin-bottom: 10px;
        }

        #channelList div {
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        #channelList div:hover {
            background-color: #bdc3c7;
        }

        #newChannel {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #2ecc71;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background-color: #27ae60;
        }

        #chatArea {
            width: 80%;
            padding: 15px;
            background-color: white;
        }

        #chatArea h3 {
            margin-bottom: 15px;
        }

        #chatMessages div {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            background-color: #ecf0f1;
        }

        #chatInput {
            display: flex;
            justify-content: space-between;
        }

        #chatText {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
        }

        #chatInput button {
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            #container {
                flex-direction: column;
            }

            #channels, #chatArea {
                width: 100%;
            }
        }
    </style>
</head>

<body>

    <h1>Class Notes Management System</h1>

    <div id="authForm">
        <h2>Login/Register</h2>
        <form id="loginForm">
            <label for="username">Username:</label>
            <input type="text" id="username" required>
            <br>
            <label for="password">Password:</label>
            <input type="password" id="password" required>
            <br>
            <button type="button" onclick="login()">Login</button>
            <button type="button" onclick="register()">Register</button>
        </form>
    </div>

    <div id="container">
        <div id="channels">
            <h3>Subjects list</h3>
            <div id="channelList">
                <!-- Channel list will be populated here -->
            </div>
            <input type="text" id="newChannel" placeholder="New channel name">
            <button onclick="addChannel()">Add Subject</button>
        </div>
        <div id="chatArea">
            <h3>Chat Area</h3>
            <div id="chatMessages">
                <!-- Chat messages will be displayed here -->
            </div>
            <div id="chatInput">
                <input type="text" id="chatText" placeholder="Type a message">
                <!-- Button to select images from local file -->
                <button onclick="selectImage()">Add Image</button>
                <!-- Hidden input to select image files -->
                <input type="file" id="imageInput" style="display: none;" accept="image/*" onchange="handleImageUpload(event)">
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        // JavaScript code for the class notes management system
        
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let channels = JSON.parse(localStorage.getItem('channels')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let currentChannel = localStorage.getItem('currentChannel') || null;

        function checkAuth() {
            if (!currentUser) {
                document.getElementById('authForm').style.display = 'block';
                document.getElementById('container').style.display = 'none';
            } else {
                document.getElementById('authForm').style.display = 'none';
                document.getElementById('container').style.display = 'flex';
                loadChannels();
                loadChat();
            }
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const user = users.find(user => user.username === username && user.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                checkAuth();
            } else {
                alert('Invalid username or password');
            }
        }

        function register() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const userExists = users.some(user => user.username === username);

            if (userExists) {
                alert('Username already taken');
            } else {
                const newUser = {
                    username: username,
                    password: password,
                    role: 'member' // Default role for new users
                };
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                alert('User registered. You can now login.');
            }
        }

        function loadChannels() {
            const channelList = document.getElementById('channelList');
            channelList.innerHTML = '';

            channels.forEach(channel => {
                const channelElement = document.createElement('div');
                channelElement.textContent = channel.name;
                channelElement.onclick = () => selectChannel(channel.name);
                channelList.appendChild(channelElement);
            });
        }

        function addChannel() {
            const newChannelName = document.getElementById('newChannel').value;

            if (newChannelName) {
                const newChannel = {
                    name: newChannelName,
                    messages: []
                };
                channels.push(newChannel);
                localStorage.setItem('channels', JSON.stringify(channels));
                document.getElementById('newChannel').value = '';
                loadChannels();
            }
        }

        function selectChannel(channelName) {
            currentChannel = channelName;
            localStorage.setItem('currentChannel', currentChannel);
            loadChat();
        }

        function loadChat() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';

            if (currentChannel) {
                const channel = channels.find(ch => ch.name === currentChannel);
                if (channel) {
                    channel.messages.forEach(message => {
                        const messageElement = document.createElement('div');
                        
                        if (message.type === 'text') {
                            messageElement.textContent = `${message.username}: ${message.text}`;
                        } else if (message.type === 'image') {
                            const imgElement = document.createElement('img');
                            imgElement.src = message.url;
                            imgElement.alt = `${message.username}'s image`;
                            imgElement.style.maxWidth = '100%';
                            imgElement.style.maxHeight = '150px';
                            messageElement.appendChild(imgElement);
                        }
                        
                        chatMessages.appendChild(messageElement);
                    });
                }
            }
        }

        function sendMessage() {
            const chatText = document.getElementById('chatText').value;

            if (chatText && currentChannel) {
                const isImageUrl = chatText.match(/\.(jpeg|jpg|gif|png)$/i) != null;
                const channel = channels.find(ch => ch.name === currentChannel);

                if (channel) {
                    let newMessage;

                    if (isImageUrl) {
                        newMessage = {
                            username: currentUser.username,
                            type: 'image',
                            url: chatText
                        };
                    } else {
                        newMessage = {
                            username: currentUser.username,
                            type: 'text',
                            text: chatText
                        };
                    }

                    channel.messages.push(newMessage);
                    localStorage.setItem('channels', JSON.stringify(channels));
                    document.getElementById('chatText').value = '';
                    loadChat();
                }
            }
        }

        // Function to handle file selection
        function selectImage() {
            const imageInput = document.getElementById('imageInput');
            imageInput.click();
        }

        // Function to handle image upload
        function handleImageUpload(event) {
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();

                reader.onload = function(e) {
                    const dataUrl = e.target.result;

                    // Create a new message object with the image data URL
                    const channel = channels.find(ch => ch.name === currentChannel);

                    if (channel) {
                        const newMessage = {
                            username: currentUser.username,
                            type: 'image',
                            url: dataUrl
                        };

                        channel.messages.push(newMessage);
                        localStorage.setItem('channels', JSON.stringify(channels));
                        document.getElementById('chatText').value = '';
                        loadChat();
                    }
                };

                reader.readAsDataURL(file);
            }
        }

        checkAuth();

    </script>

</body>

</html>
